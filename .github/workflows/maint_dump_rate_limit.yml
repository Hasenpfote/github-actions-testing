name: 'ğŸ§° Maint: Dump rate limit'

on:
  workflow_dispatch:

jobs:
  main:
    runs-on: ubuntu-latest
    steps:
      - name: Dump rate limit 
        uses: actions/github-script@v6
        with:
          script: |
            const rate_limit = await github.request('GET /rate_limit', {});
            core.notice(JSON.stringify(rate_limit.data.resources, undefined, 2));

      - name: Debug
        uses: actions/github-script@v6
        with:
          script: |
            const rate_limit = await github.request('GET /rate_limit', {});
            core.notice(typeof rate_limit.rate_limit.data.resources);
            core.notice(typeof rate_limit.rate_limit.data.resources.core);
            
            let json_after = rate_limit.rate_limit.data.resources.core.map(row => {
              return {
                "limit": row.limit,
                "used": row.used
              }
            });
            core.notice(json_after);
            
            await core.summary
              .addHeading('Test')
              .addTable([
                [{data: 'File', header: true}, {data: 'Result', header: true}],
                ['foo.js', 'Pass âœ…'],
                ['bar.js', 'Fail âŒ'],
                ['test.js', 'Pass âœ…']
              ])
              .write()
